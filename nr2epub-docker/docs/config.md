# Web UI 設定仕様

## 方針
- 改造版AozoraEpub3の設定項目にできるだけ対応する。
- 現状はWeb UI経由での設定とデフォルト値での固定実装を行う。
- 将来、INIファイル読み込みとCLI対応を予定している。

## 実装状況

### 実装済み（Web UI経由）
- **SMTP設定**（環境変数またはWeb UI）
  - ホスト、ポート、ユーザー、パスワード
  - SSL/TLS選択
  - テスト用メール送信可能

- **メール配送パラメータ**
  - 送信先メールアドレス
  - EPUB著者名、タイトル

- **ジョブ管理**
  - ジョブ進捗の非同期ポーリング表示

### 固定値（デフォルト実装）
- **出力形式**
  - 出力先: ダウンロード（ブラウザ）/ メール添付（ストリーム返却）
  - 拡張子: .epub （固定）
  - メタデータ: content.opf + nav.xhtml + toc.ncx

- **レイアウト**
  - 縦書き: 有効（固定）
  - 行の高さ: 1.8（CSS固定）
  - 文字サイズ: 100%（CSS固定）

- **文字処理**
  - 空行除去: 5行減らす、最大1行（固定）
  - 行頭字下げ: 有効（固定）
  - 自動縦中横: 有効（固定）

- **画像処理**
  - 方針: 1枚1ページに配置（固定）
  - 最大幅: 1272px、最大高さ: 1696px
  - JPEG品質: medium（sharp）
  - 形式: 元画像を保持、WebP非対応

### 未実装（将来対応予定）
- **設定ファイル（INI形式）**
  - AozoraEpub3互換のINI読み込み
  - Profile/Preset機能

- **CLIインターフェース**
  - コマンドライン引数での実行
  - 設定ファイル指定

- **詳細設定の可変化**
  - 章判定ルール（ChapterPattern等）
  - 目次抽出オプション
  - 画像処理の詳細設定
  - コメント処理

- **差分更新**
  - 新エピソードのみ取得

## Web UI 設定パラメータ

### 基本入力
- **作品URL**
  - https://ncode.syosetu.com/{ncode}/
  - 入力後「話ページを抽出」で全話リストを取得

- **話番号（カンマ/範囲指定）**
  - 例: 1,2,3
  - 例: 1-10
  - 例: 1-5,10-15

- **EPUB著者名**
  - デフォルト: なろう作品ページから抽出
  - 手動上書き可能

- **EPUBタイトル**
  - デフォルト: なろう作品ページから抽出
  - 手動上書き可能

### メール送信設定（詳細設定）
- **送信先メールアドレス**
  - 必須（メール送信時）

- **SMTPホスト**
  - デフォルト: smtp.gmail.com
  - 環境変数: SMTP_HOST

- **SMTPポート**
  - デフォルト: 587（TLS）
  - 環境変数: SMTP_PORT
  - 465はSSL指定時

- **SSL/TLS使用**
  - false: STARTTLS（ポート587）
  - true: SSL（ポート465）
  - 環境変数: SMTP_SECURE

- **SMTPユーザー**
  - 環境変数: SMTP_USER

- **SMTPパスワード**
  - 環境変数: SMTP_PASS
  - Gmailの場合: アプリパスワード使用

### 設定の保存・復元
- **LocalStorage**
  - メールアドレス、SMTP設定を自動保存
  - 「設定をクリア」で削除可能

- **エクスポート**
  - 現在の設定をJSON形式でダウンロード
  - SMTP認証情報は「***」でマスク表示

- **インポート**
  - 保存したJSON設定を読み込み
  - ファイル選択またはドラッグ&ドロップ

## AozoraEpub3 設定項目との対応表

### 表紙/表題/目次ページ
| AozoraEpub3 | Web UI | 実装状況 | 備考 |
|---|---|---|---|
| CoverPage | - | 固定 | 常に表紙を出力 |
| TitlePageWrite | - | 固定 | 常に表題ページを出力 |
| TocPage | - | 固定 | 常に目次ページを出力 |
| TocVertical | - | 固定 | 縦書き |

### スタイル
| AozoraEpub3 | Web UI | 実装状況 | 備考 |
|---|---|---|---|
| LineHeight | - | 固定 | 1.8 |
| FontSize | - | 固定 | 100% |

### 文字処理
| AozoraEpub3 | Web UI | 実装状況 | 備考 |
|---|---|---|---|
| RemoveEmptyLine | - | 固定 | 5行減らす |
| MaxEmptyLine | - | 固定 | 最大1行 |
| AutoYoko | - | 固定 | 有効 |

### 出力
| AozoraEpub3 | Web UI | 実装状況 | 備考 |
|---|---|---|---|
| DstPath | ブラウザ/メール | 実装 | 出力先は固定 |
| 拡張子 | .epub | 固定 | |
| ファイル名 | {author}\_{title}.epub | 実装 | 日本語対応 |

### メール
| AozoraEpub3 | Web UI | 実装状況 | 備考 |
|---|---|---|---|
| SMTP ホスト/ポート | 詳細設定 | 実装 | 環境変数またはUI |
| SMTP ユーザー | 詳細設定 | 実装 | 環境変数またはUI |
| SMTP パスワード | 詳細設定 | 実装 | 環境変数またはUI（非表示） |
| 送信先 | メール送信設定 | 実装 | UI指定必須 |

## 環境変数

```bash
# SMTP設定（デフォルト）
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false       # true: SSL, false: STARTTLS
SMTP_USER=your-email@gmail.com
SMTP_PASS=app-password

# なろうキャッシュ（オプション）
CACHE_DIR=.cache        # キャッシュディレクトリ
CACHE_AGE=86400000      # キャッシュ有効期限（ミリ秒）

# サーバー設定
PORT=3000               # Expressサーバーポート
```

## 互換性注記
- Web UIで設定可能な項目は現在のところSMTPと出力パラメータのみ。
- 将来、INIファイル形式で AozoraEpub3 互換の詳細設定を読み込み予定。
- CLIインターフェース実装により、スクリプト実行や自動化に対応予定。
